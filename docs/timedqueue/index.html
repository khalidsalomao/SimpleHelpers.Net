<!DOCTYPE html>
<!--[if lt IE 7 ]><html class="no-js ie6"><![endif]-->
<!--[if IE 7 ]><html class="no-js ie7"><![endif]-->
<!--[if IE 8 ]><html class="no-js ie8"><![endif]-->
<!--[if IE 9 ]><html class="no-js ie9"><![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    
      
        <title>TimedQueue - SimpleHelpers.Net</title>
      
      
      
        <link rel="canonical" href="http://khalidsalomao.github.io/SimpleHelpers.Net/docs/timedqueue/">
      
      
        <meta name="author" content="Khalid Salomão">
      
    
    <meta property="og:url" content="http://khalidsalomao.github.io/SimpleHelpers.Net/docs/timedqueue/">
    <meta property="og:title" content="SimpleHelpers.Net">
    <meta property="og:image" content="http://khalidsalomao.github.io/SimpleHelpers.Net/docs/timedqueue//../../">
    <meta name="apple-mobile-web-app-title" content="SimpleHelpers.Net">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    
    <link rel="shortcut icon" type="image/x-icon" href="../../None">
    <link rel="icon" type="image/x-icon" href="../../None">
    <style>
      @font-face {
      	font-family: 'Icon';
      	src: url('../../assets/fonts/icon.eot?52m981');
      	src: url('../../assets/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
      		   url('../../assets/fonts/icon.woff?52m981')
               format('woff'),
      		   url('../../assets/fonts/icon.ttf?52m981')
               format('truetype'),
      		   url('../../assets/fonts/icon.svg?52m981#icon')
               format('svg');
      	font-weight: normal;
      	font-style: normal;
      }
    </style>
    <link rel="stylesheet" href="../../assets/stylesheets/application-0dac3e5884.css">
    
      <link rel="stylesheet" href="../../assets/stylesheets/palettes-05ab2406df.css">
    
    
      
      
      
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open Sans:400,700|Roboto+Mono">
      <style>
        body, input {
          font-family: 'Open Sans', Helvetica, Arial, sans-serif;
        }
        pre, code {
          font-family: 'Roboto Mono', 'Courier New', 'Courier', monospace;
        }
      </style>
    
    
    <script src="../../assets/javascripts/modernizr-4ab42b99fd.js"></script>
    
  </head>
  
  
  
  <body class="palette-primary-blue-grey palette-accent-cyan">
    
      
      
    
    <div class="backdrop">
      <div class="backdrop-paper"></div>
    </div>
    <input class="toggle" type="checkbox" id="toggle-drawer">
    <input class="toggle" type="checkbox" id="toggle-search">
    <label class="toggle-button overlay" for="toggle-drawer"></label>
    <header class="header">
      <nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="stretch">
      <div class="title">
        
          <span class="path">
            
              
                Micro-libraries <i class="icon icon-link"></i>
              
            
          </span>
        
        TimedQueue
      </div>
    </div>
    
    
      
      <div class="button button-github" role="button" aria-label="GitHub">
        <a href="https://github.com/khalidsalomao" title="@khalidsalomao on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
      </div>
    
    <div class="button button-search" role="button" aria-label="Search">
      <label class="toggle-button icon icon-search" title="Search" for="toggle-search"></label>
    </div>
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>
    </header>
    <main class="main">
      
      <div class="drawer">
        <nav aria-label="Navigation">
  
  <a href="https://github.com/khalidsalomao/SimpleHelpers.Net" class="project">
    <div class="banner">
      
      <div class="name">
        <strong>
          SimpleHelpers.Net
          <span class="version">
            
          </span>
        </strong>
        
          <br>
          khalidsalomao/SimpleHelpers.Net
        
      </div>
    </div>
  </a>
  <div class="scrollable">
    <div class="wrapper">
      
        <ul class="repo">
          <li class="repo-download">
            
            <a href="https://github.com/khalidsalomao/SimpleHelpers.Net/archive/master.zip" target="_blank" title="Download" data-action="download">
              <i class="icon icon-download"></i> Download
            </a>
          </li>
          <li class="repo-stars">
            <a href="https://github.com/khalidsalomao/SimpleHelpers.Net/stargazers" target="_blank" title="Stargazers" data-action="star">
              <i class="icon icon-star"></i> Stars
              <span class="count">&ndash;</span>
            </a>
          </li>
        </ul>
        <hr>
      
      <div class="toc">
        <ul>
          
            
  <li>
    <a class="" title="SimpleHelpers.Net" href="../..">
      SimpleHelpers.Net
    </a>
    
  </li>

          
            
  <li>
    <span class="section">Micro-libraries</span>
    <ul>
      
        
  <li>
    <a class="" title="FileEncoding" href="../fileencoding/">
      FileEncoding
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="MemoryCache" href="../memorycache/">
      MemoryCache
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="ModuleContainer" href="../modulecontainer/">
      ModuleContainer
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="NamedLock" href="../namedlock/">
      NamedLock
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="ObjectDiffPatch" href="../objectdiffpatch/">
      ObjectDiffPatch
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="ObjectPool" href="../objectpool/">
      ObjectPool
    </a>
    
  </li>

      
        
  <li>
    <a class="" title="SQLiteStorage" href="../sqlitestorage/">
      SQLiteStorage
    </a>
    
  </li>

      
        
  <li>
    <a class="current" title="TimedQueue" href="./">
      TimedQueue
    </a>
    
      
        
      
      
        <ul>
          
            <li class="anchor">
              <a title="Installation" href="#installation">
                Installation
              </a>
            </li>
          
            <li class="anchor">
              <a title="Configuration" href="#configuration">
                Configuration
              </a>
            </li>
          
            <li class="anchor">
              <a title="Examples" href="#examples">
                Examples
              </a>
            </li>
          
            <li class="anchor">
              <a title="Project Information" href="#project-information">
                Project Information
              </a>
            </li>
          
        </ul>
      
    
  </li>

      
        
  <li>
    <a class="" title="ConfigManager" href="../configmanager/">
      ConfigManager
    </a>
    
  </li>

      
    </ul>
  </li>

          
            
  <li>
    <span class="section">Extra</span>
    <ul>
      
        
  <li>
    <a class="" title="gh-pages build" href="../builddocssite/">
      gh-pages build
    </a>
    
  </li>

      
    </ul>
  </li>

          
        </ul>
        
          <hr>
          <span class="section">The author</span>
          <ul>
            
            
              
              <li>
                <a href="https://github.com/khalidsalomao" target="_blank" title="@khalidsalomao on GitHub">
                  @khalidsalomao on GitHub
                </a>
              </li>
            
          </ul>
        
      </div>
    </div>
  </div>
</nav>
      </div>
      <article class="article">
        <div class="wrapper">
          
          <h1 id="simplehelperstimedqueue"><a name="user-content-simplehelperstimedqueue" href="#simplehelperstimedqueue" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>SimpleHelpers.TimedQueue<a class="headerlink" href="#simplehelperstimedqueue" title="Permanent link">#</a></h1>
<p><a href="https://www.nuget.org/packages/SimpleHelpers.TimedQueue/"><img alt="NuGet" src="https://img.shields.io/nuget/v/SimpleHelpers.TimedQueue.svg?maxAge=1200&amp;style=flat-square" /></a>
<a href="https://raw.githubusercontent.com/khalidsalomao/SimpleHelpers.Net/master/SimpleHelpers/LICENSE.txt"><img alt="GitHub license" src="https://img.shields.io/badge/license-MIT-brightgreen.svg?maxAge=3600&amp;style=flat-square" /></a></p>
<p>Fast lightweight in-memory queue that stores data in a concurrent queue and periodically process the queued items.</p>
<p>Useful for:</p>
<ul>
<li>processing items in batches;</li>
<li>grouping data for later processing;</li>
<li>async processing (consumer/producer);</li>
<li>etc.</li>
</ul>
<p>Note: this nuget package contains c# source code and depends on System.Collections.Concurrent introduced in .Net 4.0.</p>
<h2 id="installation"><a name="user-content-installation" href="#installation" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Installation<a class="headerlink" href="#installation" title="Permanent link">#</a></h2>
<h3 id="nuget-package-details"><a name="user-content-nuget-package-details" href="#nuget-package-details" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>NuGet Package Details<a class="headerlink" href="#nuget-package-details" title="Permanent link">#</a></h3>
<p>You can install using NuGet, see <a href="https://www.nuget.org/packages/SimpleHelpers.TimedQueue/">SimpleHelpers.TimedQueue at NuGet.org</a></p>
<div class="code"><pre><span></span><span class="n">PM</span><span class="p">&gt;</span> <span class="n">Install-Package</span> <span class="n">SimpleHelpers</span><span class="p">.</span><span class="n">TimedQueue</span>
</pre></div>


<p>The nuget package contains <strong>C# source code</strong>.</p>
<p>The source code will be installed in your project with the following file system structure:</p>
<div class="code"><pre><span></span>|-- &lt;project root&gt;
    |-- SimpleHelpers
        |-- TimedQueue.cs
</pre></div>


<h3 id="download"><a name="user-content-download" href="#download" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Download<a class="headerlink" href="#download" title="Permanent link">#</a></h3>
<p>If you prefer, you can also download the source code: <a href="https://raw.githubusercontent.com/khalidsalomao/SimpleHelpers.Net/master/SimpleHelpers/TimedQueue.cs">TimedQueue.cs</a></p>
<h2 id="configuration"><a name="user-content-configuration" href="#configuration" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Configuration<a class="headerlink" href="#configuration" title="Permanent link">#</a></h2>
<p>Simple configuration of the TimedQueue settings.</p>
<div class="code"><pre><span></span><span class="c1">// create our timedQueue instance</span>
<span class="n">SimpleHelpers</span><span class="p">.</span><span class="n">TimedQueue</span><span class="p">&lt;</span><span class="n">LogEvent</span><span class="p">&gt;</span> <span class="n">my_queue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SimpleHelpers</span><span class="p">.</span><span class="n">TimedQueue</span><span class="p">&lt;</span><span class="n">LogEvent</span><span class="p">&gt;</span> <span class="p">();</span>

<span class="c1">// set the queue timed task to run each 500 ms executing the registered action</span>
<span class="n">my_queue</span><span class="p">.</span><span class="n">TimerStep</span> <span class="p">=</span> <span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span> <span class="p">(</span><span class="m">500</span><span class="p">);</span>

<span class="c1">// Our event, if we want to treat the removed expired items</span>
<span class="n">my_queue</span><span class="p">.</span><span class="n">OnExecution</span> <span class="p">=</span> <span class="p">(</span><span class="n">IEnumerable</span><span class="p">&lt;</span><span class="n">Our_Object</span><span class="p">&gt;</span> <span class="n">items</span><span class="p">)</span> <span class="p">=&gt;</span>
<span class="p">{</span>
    <span class="c1">// the items IEnumerable must be consumed to clear the queued items!</span>
    <span class="k">foreach</span> <span class="p">(</span><span class="kt">var</span> <span class="n">evt</span> <span class="k">in</span> <span class="n">items</span><span class="p">)</span>
        <span class="c1">// do something</span>
<span class="p">};</span>
</pre></div>


<p>Another example passing the parameters to the constructor.</p>
<div class="code"><pre><span></span><span class="c1">// create our timedQueue instance</span>
<span class="n">SimpleHelpers</span><span class="p">.</span><span class="n">TimedQueue</span><span class="p">&lt;</span><span class="n">Our_Object</span><span class="p">&gt;</span> <span class="n">my_queue</span> <span class="p">=</span> <span class="k">new</span> <span class="n">SimpleHelpers</span><span class="p">.</span><span class="n">TimedQueue</span><span class="p">&lt;</span><span class="n">Our_Object</span><span class="p">&gt;</span> <span class="p">(</span><span class="n">TimeSpan</span><span class="p">.</span><span class="n">FromMilliseconds</span> <span class="p">(</span><span class="m">2500</span><span class="p">),</span> <span class="n">ConsumerMethod</span><span class="p">);</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Remember that since TimedQueue is executed asynchronously - in a timer thread - you should hold the reference to TimedQueue instance to avoid the instance destruction before the <code>OnExecution</code> method is invoked. The .Net garbage collector will collect all instances without that it thinks are not being used, and that may includes local method variables that are optimized by the compiler depending on how you coded it&hellip;</p>
</div>
<h2 id="examples"><a name="user-content-examples" href="#examples" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Examples<a class="headerlink" href="#examples" title="Permanent link">#</a></h2>
<h3 id="put"><a name="user-content-put" href="#put" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Put<a class="headerlink" href="#put" title="Permanent link">#</a></h3>
<p>Enqueue items to be processed by the <code>OnExecution</code> action.</p>
<div class="code"><pre><span></span>    <span class="n">my_queue</span><span class="p">.</span><span class="n">Put</span> <span class="p">(</span><span class="n">evt</span><span class="p">);</span>
</pre></div>


<p>More complex example:</p>
<div class="code"><pre><span></span><span class="c1">// our method that does an network call to store out object</span>
<span class="c1">// and keeps retrying in case of failure</span>
<span class="k">public</span> <span class="k">static</span> <span class="k">void</span> <span class="nf">SaveEvent</span> <span class="p">(</span><span class="n">Our_Object</span> <span class="n">evt</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// try to save</span>
    <span class="k">try</span>
    <span class="p">{</span>
        <span class="n">SaveOverTheInternet</span> <span class="p">(</span><span class="n">evt</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="n">IO</span><span class="p">.</span><span class="n">IOException</span> <span class="n">ex</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// log.Error (ex);</span>
        <span class="n">SimpleHelpers</span><span class="p">.</span><span class="n">TimedQueue</span><span class="p">&lt;</span><span class="n">Our_Object</span><span class="p">&gt;.</span><span class="n">Put</span> <span class="p">(</span><span class="n">evt</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>


<h2 id="project-information"><a name="user-content-project-information" href="#project-information" class="headeranchor-link" aria-hidden="true"><span class="headeranchor"></span></a>Project Information<a class="headerlink" href="#project-information" title="Permanent link">#</a></h2>
<ul>
<li><a href="../../#contribute">Contribute</a></li>
<li><a href="../../#support">Support</a></li>
<li><a href="../../#license">License</a></li>
</ul>
          <aside class="copyright" role="note">
            
              Copyright (c) 2016 Khalid Salomão &ndash;
            
            Documentation built with
            <a href="http://www.mkdocs.org" target="_blank">MkDocs</a>
            using the
            <a href="http://squidfunk.github.io/mkdocs-material/" target="_blank">
              Material
            </a>
            theme.
          </aside>
          
            <footer class="footer">
              
  <nav class="pagination" aria-label="Footer">
    <div class="previous">
      
        <a href="../sqlitestorage/" title="SQLiteStorage">
          <span class="direction">
            Previous
          </span>
          <div class="page">
            <div class="button button-previous" role="button" aria-label="Previous">
              <i class="icon icon-back"></i>
            </div>
            <div class="stretch">
              <div class="title">
                SQLiteStorage
              </div>
            </div>
          </div>
        </a>
      
    </div>
    <div class="next">
      
        <a href="../configmanager/" title="ConfigManager">
          <span class="direction">
            Next
          </span>
          <div class="page">
            <div class="stretch">
              <div class="title">
                ConfigManager
              </div>
            </div>
            <div class="button button-next" role="button" aria-label="Next">
              <i class="icon icon-forward"></i>
            </div>
          </div>
        </a>
      
    </div>
  </nav>

            </footer>
          
        </div>
      </article>
      <div class="results" role="status" aria-live="polite">
        <div class="scrollable">
          <div class="wrapper">
            <div class="meta"></div>
            <div class="list"></div>
          </div>
        </div>
      </div>
    </main>
    <script>
      var base_url = '../..';
      var repo_id  = 'khalidsalomao/SimpleHelpers.Net';
    </script>
    <script src="../../assets/javascripts/application-997097ee0c.js"></script>
    
    
  </body>
</html>